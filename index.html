<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>
<style>
  .seal-name{
    display: inline-block;
    width: 170px;
  color:black;
  font-size: 18px;
}
.seal-input {
/* position: absolute; */
margin: 3px;
/* display: block; */
width: 250px;
font-size: 14px;
height: 30px;
line-height: 30px;
outline: none;
border: 0.1px solid #dccfc3;
padding: 0px 20px;
-webkit-box-sizing: border-box;
box-sizing: border-box;}
.checke{
/* width: 10px; */
margin: 10px;
}
.seal-all{
  width: 1200px;
position: absolute;
}
.eseal{
position: absolute;
width: 250px;
margin-left: 500px;
float: left;
margin-top: 35px;
}
.seal-bt{
margin : 30px auto;
text-align: center
 
}
.seal-btn{
 
  padding: 3px 15px;
color: #be926f;
border: 1px solid #be926f;
}
.seal-btn:hover{
color: white;
background: #be926f;
}
#tuzhangdiv{
margin: 0px auto;
  width: 201.5px;
  height: 201.5px;
border: 1px solid #be926f;
}
#canvas{
  margin:25px 25px;
}
.eseal-all{
width: 750px;
height: 400px;
margin: 50px auto;
padding: 50px;
}
.eseal-name{
font-size: 35px;
color: #be926f;
text-align: center;
padding: 30px;
}
 
</style>

<body>
  <div class="eseal-all">
    <div class="eseal-name">
      <b>公司印章制作</b>
    </div>

    <div class="seal-all">
      <div class="seal">
        <span class="seal-name"> 公司名称： </span>
        <input class="seal-input" id="companyName" width="150" type="text" value='北京市人民政府' />
      </div>
      <div class="seal">
        <span class="seal-name"> 印章名称： </span>
        <input class="seal-input " id="typeName" width="150" type="text" value='采购专用章' />
      </div>
      <div class="seal">
        <span class="seal-name"> 防伪码： </span>
        <input class="seal-input" id="securityCode" width="150" type="text" value='1234567890123' />
      </div>
      <div class="seal">
        <span class="seal-name"> 公司文字大小 ： </span>
        <input class="seal-input" id="companyNameFontSize" width="150" type="text" value='17' />
      </div>
      <div class="seal">
        <span class="seal-name"> 公司文字间距 ：</span>
        <input class="seal-input" id="companyWidth" width="150" type="text" value='34' />

      </div>
      <div class="seal">
        <span class="seal-name"> 印章名称文字大小 ： </span>
        <input class="seal-input" id="typeNameFontSize" width="150" type="text" value='15' />
      </div>
      <div class="seal">
        <span class="seal-name"> 印章名称文字间距 ： </span>
        <input class="seal-input" id="typeNameMaxWidth" width="150" type="text" value='65' />
      </div>
      <div class="seal">
        <span class="seal-name"> 防伪码文字大小 ： </span>
        <input class="seal-input" id="securityCodeFontSize" width="150" type="text" value='9.2' />
      </div>
      <div class="seal">
        <span class="seal-name"> 印章名称位置 ： </span>
        <input class="seal-input" id="locationA" width="150" type="text" value='38' />
      </div>
      <div class="seal">
        <span class="seal-name"> 边线选择 ： </span>
        <input class=" checke " name="hasInnerLine" type="radio" class="hasInnerLine" value='1' /><span>双线边框</span>
        <input class="  checke" name="hasInnerLine" type="radio" class="hasInnerLine" value='0' checked /><span>单线边框</span>
      </div>
    </div>
    <div class="eseal">
      <div id="tuzhangdiv">
        <canvas id="canvas" width="153" height="153"></canvas>
      </div>
      <div class="seal-bt">
        <span class="seal-btn" type="button" onclick="javascript:createSealEx();">生成公章
        </span>
      </div>
    </div>
  </div>

</body>
<style>
</style>
<script>
  var companyNameLength
  var radius
  var hasInnerLine
  var companyName
  var typeName
  var securityCode
  var typeNameFontSize
  var typeNameMaxWidth
  var locationA
  var fontFamily
  var color
  var fontSize
  var lineWidth
  var innerLineWidth
  var lineTextGap
  var companyWidth
  var securityCodeFontSize

  function createSealEx() {
    companyNameLength = true
    radius = 76.5
    hasInnerLine = document.getElementsByName('hasInnerLine')[0].checked ? '1' : '0'
    companyName = document.getElementById('companyName').value
    typeName = document.getElementById('typeName').value
    securityCode = document.getElementById('securityCode').value
    typeNameFontSize = document.getElementById('typeNameFontSize').value
    typeNameMaxWidth = document.getElementById('typeNameMaxWidth').value
    locationA = document.getElementById('locationA').value
    companyNameFontSize = document.getElementById('companyNameFontSize').value
    companyWidth = document.getElementById('companyWidth').value
    securityCodeFontSize = document.getElementById('securityCodeFontSize').value
    fontFamily = '仿宋'
    color = '#e60021'
    lineWidth = '5'
    innerLineWidth
    _init()
    saveSealImg()
  }

  function saveSealImg() {
    var canvas = document.getElementById('canvas')
    var URL = canvas.toDataURL();
    // childByValue是在父组件on监听的方法
    // 第二个参数this.childValue是需要传的值
    return canvas.toDataURL();
  }

  function _init() {
    var canvas = document.getElementById('canvas')
    var ctx = canvas.getContext('2d');
    // 边框线的宽度
    lineWidth = 4 / 75 * radius;
    // 文字与外边框线的距离
    lineTextGap = 0.73;
    // 内边框线的宽度
    innerLineWidth = 1 / 75 * radius;
    canvas.width = canvas.height = radius * 2;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    _drawOuterLine();
    if (hasInnerLine === '1') {
      _drawInnerLine();
    }
    create5star(radius, radius, 25, 0);
    if (companyName) {
      _drawCompanyName();
    }
    if (typeName) {
      _drawTypeName();
    }
    if (securityCode) {
      _drawSecurityCode();
    }
  }

  function _drawCompanyName() {
    if (companyName.length > 19) {
      companyNameLength = false
      alert('公司名称最多只能为19个字符！')
      // throw new RangeError('公司名称最多只能为19个字符！');
      return
    }
    //公司名称
    _drawText(companyName, companyNameFontSize, false, false, false);
  }

  function _drawTypeName() {
    if (typeof typeName !== 'string') {
      companyNameLength = false
    }
    //印章名称
    _drawText(typeName, typeNameFontSize, true, false, true);
  }

  function _drawSecurityCode() {

    //  if () {
    //    //  alert('d')
    //    companyNameLength = false
    //    //  throw new TypeError('防伪码只能为字符串！');
    //  }
    if (securityCode.length > 0) {
      if (securityCode.length != '13' || typeof securityCode !== 'string') {
        alert('防伪码只能为13位！')
      } else {
        companyNameLength = true
      }
    }
    //防伪码
    _drawText(securityCode, securityCodeFontSize, false, true, true);
  }

  function _drawText(text, fontSize, isTypeName, isSecurityCode, isTextBaseline) {
    var canvas = document.getElementById('canvas')
    var ctx = canvas.getContext('2d');
    var i, letter;
    ctx.save();
    ctx.fillStyle = color;
    ctx.font = 'normal normal bold ' + fontSize + 'px ' + fontFamily;
    ctx.textBaseline = 'middle'; //法在画布上定位文本时
    //  if (isTextBaseline) {
    //    ctx.textBaseline = 'middle'; //法在画布上定位文本时
    //  } else {
    //    var textWidth = ctx.measureText(text).width
    //    console.log(textWidth)
    //  }
    //印章名称=true,公司，防伪码=false
    if (isTypeName) {
      ctx.textAlign = 'center';
    } else {
      ctx.textAlign = 'center';
      //  ctx.textAlign = 'left';
    }
    //76.5,76.5
    ctx.translate(radius, radius);
    //印章名称=true,公司，防伪码=false
    if (isTypeName) {
      //印章名称
      var charactHeight = locationA
      ctx.fillText(text, 0, charactHeight, typeNameMaxWidth);
      //  ctx.fillText(text, 0, radius / 2);
    } else {
      //公司，防伪码
      for (i = 0; i < text.length; i++) {
        letter = text[i];
        if (isSecurityCode) {
          //防伪码
          _drawLetter(letter, 0.57 - i * 0.1, -securityCodeFontSize / 2, radius * 0.8, 20, false);
        } else {
          //公司名称
          // 字数
          var startIndex = companyName.length - 1;
          // 字与字之间相差的弧度
          var step = 10.8 * Math.PI / (9 * startIndex)
          _drawLetter(letter, i * step, -fontSize / 2, -radius * lineTextGap, companyWidth, true);
          //  _drawCompanyName()
        }
      }
    }
    ctx.restore();
  }

  function _drawLetter(letter, angle, x, y, maxwidth, isTranslate) {

    var canvas = document.getElementById('canvas')
    var ctx = canvas.getContext('2d');
    //  公司名称
    if (isTranslate) {
      ctx.save();
      ctx.rotate(angle);
      ctx.translate(-45, 15, ); // 平移到此位置,此时字和x轴垂直，第一个参数是与圆外边的距离，越大距离越近
      ctx.rotate(-5 * Math.PI / 9); // 旋转90度,让字平行于x轴
      ctx.fillText(letter, 0, 0, maxwidth); // 此点为字的中心点 //
      //  ctx.fillText(letter, -45, 25); // 此点为字的中心点 //
      //maxWhdthNum
      ctx.restore();
      //  }
    } else {
      ctx.save();
      ctx.rotate(angle);
      ctx.fillText(letter, 0, y, maxwidth);
      ctx.restore();
    }
  }

  function create5star(sx, sy, radius, rotato) {

    var canvas = document.getElementById('canvas')
    var ctx = canvas.getContext('2d');
    ctx.save();
    ctx.strokeStyle = color;

    ctx.lineWidth = innerLineWidth;
    ctx.fillStyle = color;
    ctx.translate(sx, sy); //移动坐标原点
    ctx.rotate(Math.PI + rotato); //旋转
    ctx.beginPath(); //创建路径
    var x = Math.sin(0);
    var y = Math.cos(0);
    var dig = Math.PI / 5 * 4;
    for (var i = 0; i < 5; i++) { //画五角星的五条边  
      var x = Math.sin(i * dig);
      var y = Math.cos(i * dig);
      ctx.lineTo(x * radius, y * radius);
    }
    ctx.closePath();
    ctx.stroke();
    ctx.fill();
    ctx.restore();
  }

  function _drawOuterLine() {

    var canvas = document.getElementById('canvas')
    var ctx = canvas.getContext('2d');
    ctx.save();
    ctx.strokeStyle = color;
    ctx.lineWidth = lineWidth;
    ctx.beginPath();
    ctx.arc(radius, radius, radius - lineWidth, 0, Math.PI * 2, true);
    ctx.stroke();
    ctx.restore();
  }

  function _drawInnerLine() {

    var canvas = document.getElementById('canvas')
    var ctx = canvas.getContext('2d');
    ctx.save();
    ctx.strokeStyle = color;
    ctx.lineWidth = innerLineWidth;
    ctx.beginPath();
    ctx.arc(radius, radius, radius - lineWidth - radius / 15, 0, Math.PI * 2, true);
    ctx.stroke();
    ctx.restore();
  }
</script>

</html>